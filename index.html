<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>POC - 100</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    /* Garantir espaço e overflow visível para os selects abrirem sempre para baixo. */
    body {
      padding-bottom: 280px;
    }

    .app-main,
    .view-panel,
    .tab-panel,
    .form-grid {
      overflow: visible;
    }

    /* Listbox: exibir opções em orientação top-down sem corte. */
    .listbox-select {
      height: auto;
      max-height: none;
      overflow: visible;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<body>
  <header class="app-header">
    <div class="container header-content">
      <img src="assets/css/logo.png" alt="Logo Wwin Safety" class="logo" />
      <divc class="header-title">
        <h1>P.O.C 100</h1>
      </div>
    </div>
  </header>

  <main class="container app-main">
    <section class="view-toggle" aria-label="Ações principais">
      <button type="button" class="tab-button is-active" data-view="cadastrar">Cadastrar</button>
      <button type="button" class="tab-button" data-view="consultar">Consultar</button>
    </section>

    <section class="view-panel is-active" data-view-panel="cadastrar">
      <form id="poc-form" novalidate>
        <div class="tabs" role="tablist">
          <button type="button" class="tab is-active" data-tab="basicos" role="tab" aria-selected="true">Dados Básicos</button>
          <button type="button" class="tab is-disabled" data-tab="inseguras" role="tab" aria-selected="false" aria-disabled="true">Práticas / Condição Inseguras</button>
          <button type="button" class="tab is-disabled" data-tab="seguras" role="tab" aria-selected="false" aria-disabled="true">Reconhecimento de Prática Segura</button>
        </div>

        <div class="tab-panel is-active" data-tab-panel="basicos" role="tabpanel">
          <h2>Dados Básicos</h2>
          <div class="form-grid">
            <label><strong>Unidade*</strong>
              <select id="unidadeSelect" class="listbox-select" size="4" required>
                <option value="">Selecione</option>
                <option value="Vespasiano">Vespasiano</option>
                <option value="Porto Açu">Porto Açu</option>
                <option value="Contagem">Contagem</option>
              </select>
            </label>
            <label><strong>Setor*</strong>
              <select id="setorSelect" class="listbox-select" size="4" required disabled>
                  <option value="">Selecione</option>
              </select>
            </label>
            <label><strong>Subsetor*</strong>
              <select id="subsetorSelect" class="listbox-select" size="4" required disabled>
                <option value="">Selecione</option>
              </select>
            </label>
            <label><strong>Observador*</strong>
              <select id="observador" required>
                <option value="">Selecione</option>
                <option value="davi">Davi</option>
                <option value="brayan">Brayan</option>
                <option value="samuel">Samuel</option>
                <option value="lucas">Lucas</option>
                <option value="walef">Walef</option>
                <option value="welington">Welington</option>
                <option value="eder">Eder</option>
                <option value="guilherme">Guilherme</option>
                <option value="humberto">Humberto</option>
                <option value="wagner">Wagner</option>
              </select>
            </label>
            <label>Acompanhante
              <select id="acompanhante">
                <option value="">Selecione</option>
                <option value="davi">Davi</option>
                <option value="brayan">Brayan</option>
                <option value="samuel">Samuel</option>
                <option value="lucas">Lucas</option>
                <option value="walef">Walef</option>
                <option value="welington">Welington</option>
                <option value="eder">Eder</option>
                <option value="guilherme">Guilherme</option>
                <option value="humberto">Humberto</option>
                <option value="wagner">Wagner</option>
              </select>
            </label>
            <label><strong>Data*</strong>
              <input type="date" id="data" required />
            </label>
            <label><strong>Hora*</strong>
              <input type="time" id="hora" required />
            </label>
            <label><strong>Pessoas Observadas*</strong>
              <input type="number" id="pessoas-observadas" min="1" required />
            </label>
            <label><strong>Pessoas na Área*</strong>
              <input type="number" id="pessoas-area" min="1" required />
            </label>
          </div>

          <fieldset class="radio-group">
            <legend><strong>Tipo de registro*</strong></legend>
            <label>
              <input type="radio" name="tipo-registro" value="insegura" required />
              Prática / Condição Insegura
            </label>
            <label>
              <input type="radio" name="tipo-registro" value="segura" required />
              Reconhecimento de Prática Segura
            </label>
          </fieldset>
        </div>

        <div class="tab-panel" data-tab-panel="inseguras" role="tabpanel">
          <h2>Práticas / Condição Inseguras</h2>
          <div class="unsafe-layout">
            <div class="unsafe-practices">
              <p><strong>Prática (A-F)*</strong></p>
              <ul class="practice-list" id="practice-list">
                <li data-practice="A">Reação das Pessoas</li>
                <li data-practice="B">Posição das Pessoas</li>
                <li data-practice="C">EPIs</li>
                <li data-practice="D">Ferramentas e Equipamentos</li>
                <li data-practice="E">Procedimentos</li>
                <li data-practice="F">Ordem, Limpeza e Organização</li>
              </ul>
              <input type="hidden" id="practice-selected" required />
            </div>
            <div class="unsafe-fields">
              <label><strong>Subcategoria*</strong>
                <select id="subcategoria" required>
                  <option value="">Selecione</option>
                  <option value="epi">Uso de EPI</option>
                  <option value="equipamento">Equipamento</option>
                  <option value="ambiente">Ambiente</option>
                </select>
              </label>
              <label><strong>Quem foi observado?*</strong>
                <select id="observado" required>
                  <option value="">Selecione</option>
                  <option value="colaborador">Colaborador</option>
                  <option value="terceiro">Terceiro</option>
                  <option value="visitante">Visitante</option>
                </select>
              </label>
              <label><strong>Quantidade*</strong>
                <input type="number" id="quantidade" min="1" required />
              </label>
              <label><strong>Prática Insegura*</strong>
                <textarea id="pratica-insegura" rows="3" required></textarea>
              </label>
              <label><strong>Ação Recomendada*</strong>
                <textarea id="acao-recomendada" rows="3" required></textarea>
              </label>
            </div>
          </div>
        </div>

        <div class="tab-panel" data-tab-panel="seguras" role="tabpanel">
          <h2>Reconhecimento de Prática Segura</h2>
          <label><strong>Reconhecimento do Trabalho Seguro*</strong>
            <textarea id="reconhecimento" rows="4" required></textarea>
          </label>
          <label>Observação
            <textarea id="observacao" rows="3"></textarea>
          </label>
        </div>

        <div class="form-actions">
          <button type="button" id="add-btn" class="primary" disabled>Adicionar</button>
        </div>
      </form>
    </section>

    <section class="view-panel" data-view-panel="consultar">
      <div class="consultar">
        <h2>Consultar POC</h2>
        <div class="form-grid">
          <label><strong>Unidade*</strong>
              <select id="unidade-consulta" required>
                <option value="">Selecione</option>
                <option value="vespasiano">Vespasiano</option>
                <option value="portoacu">Porto Açu</option>
                <option value="contagem">Contagem</option>
              </select>
            </label>
            <label><strong>Setor*</strong>
              <select id="setor-consulta" required>
                  <option value="">Selecione</option>
                  <option value="administrativo">Administrativo</option>
                  <option value="caldeiraria">Caldeiraria</option>
                  <option value="montagem">Montagem</option>
                  <option value="usinagem">Usinagem</option>
                  <option value="manutencao">Manutenção</option>
              </select>
            </label>
            <label><strong>Subsetor*</strong>
              <select id="subsetor-consulta" required>
                <option value="">Selecione</option>
                <option value="fiscal">Fiscal</option>
                <option value="financeiro">Financeiro</option>
                <option value="gg">GG</option>
                <option value="inovacao">Inovação</option>
                <option value="ti">TI</option>
                <option value="facilities">Facilities</option>
                <option value="almoxarifado">Almoxarifado</option>
                <option value="ems">EMS</option>
                <option value="pcp">PCP</option>
                <option value="ambulatorio">Ambulatório</option>
              </select>
            </label>
            <label><strong>Observador*</strong>
              <select id="observador" required>
                <option value="">Selecione</option>
                <option value="davi">Davi</option>
                <option value="brayan">Brayan</option>
                <option value="samuel">Samuel</option>
                <option value="lucas">Lucas</option>
                <option value="walef">Walef</option>
                <option value="welington">Welington</option>
                <option value="eder">Eder</option>
                <option value="guilherme">Guilherme</option>
                <option value="humberto">Humberto</option>
                <option value="wagner">Wagner</option>
              </select>
            </label>
            <label>Acompanhante
              <select id="acompanhante">
                <option value="">Selecione</option>
                <option value="davi">Davi</option>
                <option value="brayan">Brayan</option>
                <option value="samuel">Samuel</option>
                <option value="lucas">Lucas</option>
                <option value="walef">Walef</option>
                <option value="welington">Welington</option>
                <option value="eder">Eder</option>
                <option value="guilherme">Guilherme</option>
                <option value="humberto">Humberto</option>
                <option value="wagner">Wagner</option>
              </select>
            </label>
          <label>Data início
            <input type="date" id="filtro-data-inicio" />
          </label>
          <label>Data fim
            <input type="date" id="filtro-data-fim" />
          </label>
          <label>Hora início
            <input type="time" id="filtro-hora-inicio" />
          </label>
          <label>Hora fim
            <input type="time" id="filtro-hora-fim" />
          </label>
        </div>
        <div class="form-actions">
          <button type="button" id="consultar-btn" class="primary">Consultar</button>
        </div>
        <div id="consulta-resultado" class="consulta-resultado" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <script
    src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script>
    // Mapeamento de unidades -> setores -> subsetores.
    const MAP = {
      Vespasiano: {
        Administrativo: [
          'Comercial',
          'diretoria',
          'Engenharia de Aplicações e Vendas',
          'Facilites',
          'Financeiro',
          'Gente e Gestão',
          'Gerência de Projetos',
          'Marketing',
          'Pesquisa e Desenvolvimento',
          'SGQ',
          'Suprimentos',
          'TI'
        ],
        Almoxarifado: [
          'Almoxarifado',
          'Chaparia',
          'Magazine'
        ],
        'Area Externa': [
          'Área Externa',
          'Banker',
          'Estacionamento',
          'FAT',
          'Montagem de Andaimes',
          'Oficina de Excelência Operacional',
          'Sala de Treinamento'
        ],
        Calderaria: [
          'CD - Centro de Distribuição',
          'Célula A',
          'Célula B',
          'Célula ME',
          'Célula Robotizada',
          'Célula T',
          'Centro Tecnológico Soldagem',
          'Forno'
        ],
        CQ: [
          'CQ Documental',
          'CQ Fábrica'
        ],
        'Field Service': [
          'Administrativo',
          'Almoxarifado',
          'DOW',
          'Obra Coifa',
          'Saipem Guarujá-SP'
        ],
        Logística: [
          'Expedição',
          'Operadores de ponte',
          'Serviços Gerais'
        ],
        Manutenção: [
          'Manutenção',
          'Terceiros'
        ],
        'Montagem de Campo': [
          'Montagem de Estacas'
        ],
        'Montagem Mecanica': [
          'Montagem Mecanica'
        ],
        Pintura: [
          'Pintura'
        ],
        'Produtivo Indireto': [
          'Engenaria Industria Usinagem',
          'Engenharia de Calderaria',
          'Engenharia de Materiais e Solda',
          'Engenaria de Usinagem',
          'Engenharia Industrial Mecanica',
          'Excelência Operaciona',
          'Gerência da Produção',
          'Melhoria de Manufatura',
          'Metrologia',
          'PCP',
          'SESMT',
          'SGA'
        ],
        Terceiros: [
          'Clientes Residente',
          'Cliente Visitante',
          'Conservação e Limpeza',
          'Fretamento (Allure)',
          'Portaria',
          'Restaurante',
          'Vigilancia e Portaria'
        ],
        Usinagem: [
          'Ferramentaria',
          'Leve',
          'Pesada'
        ]
      },
      Contagem: 'Vespasiano',
      'Porto Açu': {
        Cais: [
          'Montagem/Soldagem'
        ],
        'Galpão Delp Açu': [
          'Administrativo',
          'Árae de Produção',
          'Manutenção',
          'Montagem/Mov de Carga',
          'Soldagem'
        ],
        'Montagem Externa': [
          'Jumper Niterói/ Bacalhau'
        ]
      }
    };

    // Resolve aliases (ex.: Contagem -> Vespasiano).
    const resolveUnitMap = (unit) => {
      if (!unit) return null;
      const unitMap = MAP[unit];
      if (!unitMap) return null;
      if (typeof unitMap === 'string') {
        return MAP[unitMap] || null;
      }
      return unitMap;
    };

    // Limpa o select, aplica placeholder, ajusta tamanho e opcionalmente desabilita.
    const resetSelect = (select, disabled = true) => {
      select.empty();
      select.append(new Option('Selecione', ''));
      select.attr('size', 2);
      select.prop('disabled', disabled);
    };

    // Preenche um select com itens, ajusta o tamanho para exibir tudo e habilita.
    const fillSelect = (select, items = []) => {
      resetSelect(select, false);
      items.forEach((item) => {
        select.append(new Option(item, item));
      });
      select.attr('size', Math.max(items.length + 1, 2));
    };

    $(document).ready(() => {
      const unidadeSelect = $('#unidadeSelect');
      const setorSelect = $('#setorSelect');
      const subsetorSelect = $('#subsetorSelect');

      // Ajusta o tamanho do listbox de unidade para exibir todas as opções.
      unidadeSelect.attr('size', unidadeSelect.find('option').length);

      resetSelect(setorSelect, true);
      resetSelect(subsetorSelect, true);

      // Ao escolher unidade: reseta setor/subsetor e preenche setor.
      unidadeSelect.on('change', () => {
        const unidade = unidadeSelect.val();
        resetSelect(setorSelect, true);
        resetSelect(subsetorSelect, true);

        const unitMap = resolveUnitMap(unidade);
        if (!unitMap) return;
        fillSelect(setorSelect, Object.keys(unitMap));
      });

      // Ao escolher setor: reseta subsetor e preenche subsetor.
      setorSelect.on('change', () => {
        const unidade = unidadeSelect.val();
        const setor = setorSelect.val();
        resetSelect(subsetorSelect, true);

        const unitMap = resolveUnitMap(unidade);
        if (!unitMap || !setor) return;
        fillSelect(subsetorSelect, unitMap[setor] || []);
      });
    });
  </script>
  <script src="assets/js/app.js"></script>
</body>
</html>
